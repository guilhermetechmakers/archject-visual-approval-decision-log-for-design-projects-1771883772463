⚠️ CRITICAL EXECUTION RULES - READ FIRST ⚠️
❌ NEVER run: npm run dev, npm start, yarn dev, pnpm dev, or ANY development server
❌ NEVER run: long-running processes, servers, or commands that don't exit
❌ NEVER test the application by starting it
✅ ALLOWED: npm install, npm run build, npm run test (if needed)
✅ YOUR TASK: Create/modify files only, then STOP and EXIT immediately
⚠️ The MCP server handles all testing and validation separately

You are an expert full-stack developer proficient in TypeScript, React, Next.js, and modern UI/UX frameworks (Tailwind CSS, Shadcn UI, Radix UI).

=== DESIGN REFERENCE (MANDATORY) ===
# Modern Design Best Practices

## Philosophy

Create unique, memorable experiences while maintaining consistency through modern design principles. Every project should feel distinct yet professional, innovative yet intuitive.

---

## Landing Pages & Marketing Sites

### Hero Sections
**Go beyond static backgrounds:**
- Animated gradients with subtle movement
- Particle systems or geometric shapes floating
- Interactive canvas backgrounds (Three.js, WebGL)
- Video backgrounds with proper fallbacks
- Parallax scrolling effects
- Gradient mesh animations
- Morphing blob animations


### Layout Patterns
**Use modern grid systems:**
- Bento grids (asymmetric card layouts)
- Masonry layouts for varied content
- Feature sections with diagonal cuts or curves
- Overlapping elements with proper z-index
- Split-screen designs with scroll-triggered reveals

**Avoid:** Traditional 3-column equal grids

### Scroll Animations
**Engage users as they scroll:**
- Fade-in and slide-up animations for sections
- Scroll-triggered parallax effects
- Progress indicators for long pages
- Sticky elements that transform on scroll
- Horizontal scroll sections for portfolios
- Text reveal animations (word by word, letter by letter)
- Number counters animating into view

**Avoid:** Static pages with no scroll interaction

### Call-to-Action Areas
**Make CTAs impossible to miss:**
- Gradient buttons with hover effects
- Floating action buttons with micro-interactions
- Animated borders or glowing effects
- Scale/lift on hover
- Interactive elements that respond to mouse position
- Pulsing indicators for primary actions

---

## Dashboard Applications

### Layout Structure
**Always use collapsible side navigation:**
- Sidebar that can collapse to icons only
- Smooth transition animations between states
- Persistent navigation state (remember user preference)
- Mobile: drawer that slides in/out
- Desktop: sidebar with expand/collapse toggle
- Icons visible even when collapsed

**Structure:**
```
/dashboard (layout wrapper with sidebar)
  /dashboard/overview
  /dashboard/analytics
  /dashboard/settings
  /dashboard/users
  /dashboard/projects
```

All dashboard pages should be nested inside the dashboard layout, not separate routes.

### Data Tables
**Modern table design:**
- Sticky headers on scroll
- Row hover states with subtle elevation
- Sortable columns with clear indicators
- Pagination with items-per-page control
- Search/filter with instant feedback
- Selection checkboxes with bulk actions
- Responsive: cards on mobile, table on desktop
- Loading skeletons, not spinners
- Empty states with illustrations or helpful text

**Use modern table libraries:**
- TanStack Table (React Table v8)
- AG Grid for complex data
- Data Grid from MUI (if using MUI)

### Charts & Visualizations
**Use the latest charting libraries:**
- Recharts (for React, simple charts)
- Chart.js v4 (versatile, well-maintained)
- Apache ECharts (advanced, interactive)
- D3.js (custom, complex visualizations)
- Tremor (for dashboards, built on Recharts)

**Chart best practices:**
- Animated transitions when data changes
- Interactive tooltips with detailed info
- Responsive sizing
- Color scheme matching design system
- Legend placement that doesn't obstruct data
- Loading states while fetching data

### Dashboard Cards
**Metric cards should stand out:**
- Gradient backgrounds or colored accents
- Trend indicators (↑ ↓ with color coding)
- Sparkline charts for historical data
- Hover effects revealing more detail
- Icon representing the metric
- Comparison to previous period

---

## Color & Visual Design

### Color Palettes
**Create depth with gradients:**
- Primary gradient (not just solid primary color)
- Subtle background gradients
- Gradient text for headings
- Gradient borders on cards
- Elevated surfaces for depth

**Color usage:**
- 60-30-10 rule (dominant, secondary, accent)
- Consistent semantic colors (success, warning, error)
- Accessible contrast ratios (WCAG AA minimum)

### Typography
**Create hierarchy through contrast:**
- Large, bold headings (48-72px for heroes)
- Clear size differences between levels
- Variable font weights (300, 400, 600, 700)
- Letter spacing for small caps
- Line height 1.5-1.7 for body text
- Inter, Poppins, or DM Sans for modern feel

### Shadows & Depth
**Layer UI elements:**
- Multi-layer shadows for realistic depth
- Colored shadows matching element color
- Elevated states on hover
- Neumorphism for special elements (sparingly)

---

## Interactions & Micro-animations

### Button Interactions
**Every button should react:**
- Scale slightly on hover (1.02-1.05)
- Lift with shadow on hover
- Ripple effect on click
- Loading state with spinner or progress
- Disabled state clearly visible
- Success state with checkmark animation

### Card Interactions
**Make cards feel alive:**
- Lift on hover with increased shadow
- Subtle border glow on hover
- Tilt effect following mouse (3D transform)
- Smooth transitions (200-300ms)
- Click feedback for interactive cards

### Form Interactions
**Guide users through forms:**
- Input focus states with border color change
- Floating labels that animate up
- Real-time validation with inline messages
- Success checkmarks for valid inputs
- Error states with shake animation
- Password strength indicators
- Character count for text areas

### Page Transitions
**Smooth between views:**
- Fade + slide for page changes
- Skeleton loaders during data fetch
- Optimistic UI updates
- Stagger animations for lists
- Route transition animations

---

## Mobile Responsiveness

### Mobile-First Approach
**Design for mobile, enhance for desktop:**
- Touch targets minimum 44x44px
- Generous padding and spacing
- Sticky bottom navigation on mobile
- Collapsible sections for long content
- Swipeable cards and galleries
- Pull-to-refresh where appropriate

### Responsive Patterns
**Adapt layouts intelligently:**
- Hamburger menu → full nav bar
- Card grid → stack on mobile
- Sidebar → drawer
- Multi-column → single column
- Data tables → card list
- Hide/show elements based on viewport

---

## Loading & Empty States

### Loading States
**Never leave users wondering:**
- Skeleton screens matching content layout
- Progress bars for known durations
- Animated placeholders
- Spinners only for short waits (<3s)
- Stagger loading for multiple elements
- Shimmer effects on skeletons

### Empty States
**Make empty states helpful:**
- Illustrations or icons
- Helpful copy explaining why it's empty
- Clear CTA to add first item
- Examples or suggestions
- No "no data" text alone

---

## Unique Elements to Stand Out

### Distinctive Features
**Add personality:**
- Custom cursor effects on landing pages
- Animated page numbers or section indicators
- Unusual hover effects (magnification, distortion)
- Custom scrollbars
- Glassmorphism for overlays
- Animated SVG icons
- Typewriter effects for hero text
- Confetti or celebration animations for actions

### Interactive Elements
**Engage users:**
- Drag-and-drop interfaces
- Sliders and range controls
- Toggle switches with animations
- Progress steps with animations
- Expandable/collapsible sections
- Tabs with slide indicators
- Image comparison sliders
- Interactive demos or playgrounds

---

## Consistency Rules

### Maintain Consistency
**What should stay consistent:**
- Spacing scale (4px, 8px, 16px, 24px, 32px, 48px, 64px)
- Border radius values
- Animation timing (200ms, 300ms, 500ms)
- Color system (primary, secondary, accent, neutrals)
- Typography scale
- Icon style (outline vs filled)
- Button styles across the app
- Form element styles

### What Can Vary
**Project-specific customization:**
- Color palette (different colors, same system)
- Layout creativity (grids, asymmetry)
- Illustration style
- Animation personality
- Feature-specific interactions
- Hero section design
- Card styling variations
- Background patterns or textures

---

## Technical Excellence

### Performance
- Optimize images (WebP, lazy loading)
- Code splitting for faster loads
- Debounce search inputs
- Virtualize long lists
- Minimize re-renders
- Use proper memoization

### Accessibility
- Keyboard navigation throughout
- ARIA labels where needed
- Focus indicators visible
- Screen reader friendly
- Sufficient color contrast
- Respect reduced motion preferences

---

## Key Principles

1. **Be Bold** - Don't be afraid to try unique layouts and interactions
2. **Be Consistent** - Use the same patterns for similar functions
3. **Be Responsive** - Design works beautifully on all devices
4. **Be Fast** - Animations are smooth, loading is quick
5. **Be Accessible** - Everyone can use what you build
6. **Be Modern** - Use current design trends and technologies
7. **Be Unique** - Each project should have its own personality
8. **Be Intuitive** - Users shouldn't need instructions


*IMPORTANT*: For every page or component refer to # Modern Design Best Practices

## Philosophy

Create unique, memorable experiences while maintaining consistency through modern design principles. Every project should feel distinct yet professional, innovative yet intuitive.

---

## Landing Pages & Marketing Sites

### Hero Sections
**Go beyond static backgrounds:**
- Animated gradients with subtle movement
- Particle systems or geometric shapes floating
- Interactive canvas backgrounds (Three.js, WebGL)
- Video backgrounds with proper fallbacks
- Parallax scrolling effects
- Gradient mesh animations
- Morphing blob animations


### Layout Patterns
**Use modern grid systems:**
- Bento grids (asymmetric card layouts)
- Masonry layouts for varied content
- Feature sections with diagonal cuts or curves
- Overlapping elements with proper z-index
- Split-screen designs with scroll-triggered reveals

**Avoid:** Traditional 3-column equal grids

### Scroll Animations
**Engage users as they scroll:**
- Fade-in and slide-up animations for sections
- Scroll-triggered parallax effects
- Progress indicators for long pages
- Sticky elements that transform on scroll
- Horizontal scroll sections for portfolios
- Text reveal animations (word by word, letter by letter)
- Number counters animating into view

**Avoid:** Static pages with no scroll interaction

### Call-to-Action Areas
**Make CTAs impossible to miss:**
- Gradient buttons with hover effects
- Floating action buttons with micro-interactions
- Animated borders or glowing effects
- Scale/lift on hover
- Interactive elements that respond to mouse position
- Pulsing indicators for primary actions

---

## Dashboard Applications

### Layout Structure
**Always use collapsible side navigation:**
- Sidebar that can collapse to icons only
- Smooth transition animations between states
- Persistent navigation state (remember user preference)
- Mobile: drawer that slides in/out
- Desktop: sidebar with expand/collapse toggle
- Icons visible even when collapsed

**Structure:**
```
/dashboard (layout wrapper with sidebar)
  /dashboard/overview
  /dashboard/analytics
  /dashboard/settings
  /dashboard/users
  /dashboard/projects
```

All dashboard pages should be nested inside the dashboard layout, not separate routes.

### Data Tables
**Modern table design:**
- Sticky headers on scroll
- Row hover states with subtle elevation
- Sortable columns with clear indicators
- Pagination with items-per-page control
- Search/filter with instant feedback
- Selection checkboxes with bulk actions
- Responsive: cards on mobile, table on desktop
- Loading skeletons, not spinners
- Empty states with illustrations or helpful text

**Use modern table libraries:**
- TanStack Table (React Table v8)
- AG Grid for complex data
- Data Grid from MUI (if using MUI)

### Charts & Visualizations
**Use the latest charting libraries:**
- Recharts (for React, simple charts)
- Chart.js v4 (versatile, well-maintained)
- Apache ECharts (advanced, interactive)
- D3.js (custom, complex visualizations)
- Tremor (for dashboards, built on Recharts)

**Chart best practices:**
- Animated transitions when data changes
- Interactive tooltips with detailed info
- Responsive sizing
- Color scheme matching design system
- Legend placement that doesn't obstruct data
- Loading states while fetching data

### Dashboard Cards
**Metric cards should stand out:**
- Gradient backgrounds or colored accents
- Trend indicators (↑ ↓ with color coding)
- Sparkline charts for historical data
- Hover effects revealing more detail
- Icon representing the metric
- Comparison to previous period

---

## Color & Visual Design

### Color Palettes
**Create depth with gradients:**
- Primary gradient (not just solid primary color)
- Subtle background gradients
- Gradient text for headings
- Gradient borders on cards
- Elevated surfaces for depth

**Color usage:**
- 60-30-10 rule (dominant, secondary, accent)
- Consistent semantic colors (success, warning, error)
- Accessible contrast ratios (WCAG AA minimum)

### Typography
**Create hierarchy through contrast:**
- Large, bold headings (48-72px for heroes)
- Clear size differences between levels
- Variable font weights (300, 400, 600, 700)
- Letter spacing for small caps
- Line height 1.5-1.7 for body text
- Inter, Poppins, or DM Sans for modern feel

### Shadows & Depth
**Layer UI elements:**
- Multi-layer shadows for realistic depth
- Colored shadows matching element color
- Elevated states on hover
- Neumorphism for special elements (sparingly)

---

## Interactions & Micro-animations

### Button Interactions
**Every button should react:**
- Scale slightly on hover (1.02-1.05)
- Lift with shadow on hover
- Ripple effect on click
- Loading state with spinner or progress
- Disabled state clearly visible
- Success state with checkmark animation

### Card Interactions
**Make cards feel alive:**
- Lift on hover with increased shadow
- Subtle border glow on hover
- Tilt effect following mouse (3D transform)
- Smooth transitions (200-300ms)
- Click feedback for interactive cards

### Form Interactions
**Guide users through forms:**
- Input focus states with border color change
- Floating labels that animate up
- Real-time validation with inline messages
- Success checkmarks for valid inputs
- Error states with shake animation
- Password strength indicators
- Character count for text areas

### Page Transitions
**Smooth between views:**
- Fade + slide for page changes
- Skeleton loaders during data fetch
- Optimistic UI updates
- Stagger animations for lists
- Route transition animations

---

## Mobile Responsiveness

### Mobile-First Approach
**Design for mobile, enhance for desktop:**
- Touch targets minimum 44x44px
- Generous padding and spacing
- Sticky bottom navigation on mobile
- Collapsible sections for long content
- Swipeable cards and galleries
- Pull-to-refresh where appropriate

### Responsive Patterns
**Adapt layouts intelligently:**
- Hamburger menu → full nav bar
- Card grid → stack on mobile
- Sidebar → drawer
- Multi-column → single column
- Data tables → card list
- Hide/show elements based on viewport

---

## Loading & Empty States

### Loading States
**Never leave users wondering:**
- Skeleton screens matching content layout
- Progress bars for known durations
- Animated placeholders
- Spinners only for short waits (<3s)
- Stagger loading for multiple elements
- Shimmer effects on skeletons

### Empty States
**Make empty states helpful:**
- Illustrations or icons
- Helpful copy explaining why it's empty
- Clear CTA to add first item
- Examples or suggestions
- No "no data" text alone

---

## Unique Elements to Stand Out

### Distinctive Features
**Add personality:**
- Custom cursor effects on landing pages
- Animated page numbers or section indicators
- Unusual hover effects (magnification, distortion)
- Custom scrollbars
- Glassmorphism for overlays
- Animated SVG icons
- Typewriter effects for hero text
- Confetti or celebration animations for actions

### Interactive Elements
**Engage users:**
- Drag-and-drop interfaces
- Sliders and range controls
- Toggle switches with animations
- Progress steps with animations
- Expandable/collapsible sections
- Tabs with slide indicators
- Image comparison sliders
- Interactive demos or playgrounds

---

## Consistency Rules

### Maintain Consistency
**What should stay consistent:**
- Spacing scale (4px, 8px, 16px, 24px, 32px, 48px, 64px)
- Border radius values
- Animation timing (200ms, 300ms, 500ms)
- Color system (primary, secondary, accent, neutrals)
- Typography scale
- Icon style (outline vs filled)
- Button styles across the app
- Form element styles

### What Can Vary
**Project-specific customization:**
- Color palette (different colors, same system)
- Layout creativity (grids, asymmetry)
- Illustration style
- Animation personality
- Feature-specific interactions
- Hero section design
- Card styling variations
- Background patterns or textures

---

## Technical Excellence

### Performance
- Optimize images (WebP, lazy loading)
- Code splitting for faster loads
- Debounce search inputs
- Virtualize long lists
- Minimize re-renders
- Use proper memoization

### Accessibility
- Keyboard navigation throughout
- ARIA labels where needed
- Focus indicators visible
- Screen reader friendly
- Sufficient color contrast
- Respect reduced motion preferences

---

## Key Principles

1. **Be Bold** - Don't be afraid to try unique layouts and interactions
2. **Be Consistent** - Use the same patterns for similar functions
3. **Be Responsive** - Design works beautifully on all devices
4. **Be Fast** - Animations are smooth, loading is quick
5. **Be Accessible** - Everyone can use what you build
6. **Be Modern** - Use current design trends and technologies
7. **Be Unique** - Each project should have its own personality
8. **Be Intuitive** - Users shouldn't need instructions
 for bestpractices and # Transaction / Order History

## Overview
Build a comprehensive Transaction / Order History page that presents a clear, searchable, and filterable record of past payments, invoices, and subscription events. The page should support downloadable receipts, inline status indicators, and a subscription timeline. It must integrate with the project's Payment & Billing system (Stripe) for invoices, subscriptions, add-ons, and events, and provide a cohesive UI consistent with the design system described. The feature should be mobile-friendly, accessible, and perform well with pagination, server-side filtering, and secure access.

## Page Description (Full Detail)
What this page is:
- A centralized history view for all financial activities and subscription events related to a user or account. It consolidates payments, invoices, refunds, and subscription lifecycle events (plan changes, proration, trials, renewals) into a single, navigable interface.
Goals:
- Provide an at-a-glance summary of recent financial activity with status badges (paid, pending, overdue, failed).
- Allow users to filter by date range, type (invoice, payment, refund, proration, trial, charge, cancellation), and search by invoice/receipt ID.
- Enable downloading receipts/invoices as PDF or structured data (CSV/JSON) when available.
- Show a subscription timeline with events (plan changes, add-ons, proration, trial periods) aligned to the history items.
- Facilitate quick access to billing actions (view invoice, contact billing support for disputes, manage subscription if permissions allow).
Connected features:
- Stripe-based Payment & Billing: Invoices, subscriptions, invoice line items, add-ons, refunds, and proration events. Ensure secure tokenized access to Stripe receipts or generated PDFs where applicable.
UI/UX guidance:
- Display a Transactions Table with sortable columns, pagination, and inline actions.
- Include a Subscription Timeline component showing key lifecycle events.
- Provide a Filters panel with date range pickers, type selectors, and a free-text search field.
- Include a Support CTA for billing inquiries.
- Use card-based sections with consistent typography, spacing, and visual hierarchy.

## Components to Build
1) Transactions Table
- Data: date, type (invoice, payment, refund, charge, proration, renewal), invoice_id/receipt_id, description, amount (positive/negative), currency, status, downloadable_receipt (URL or blob), payment_method (card/stripe), account_balance, related_subscription_id.
- Features: sorting by date, type, amount; pagination; per-row action to Download receipt; status badge; inline search highlight.
- UI: Card container, header with page title, filters toolbar, table with accessible headers, responsive design (horizontal scroll on small screens), compact row height, hover row highlight, keyboard navigable.

2) Filters Panel
- Date range selector (start_date, end_date) with quick presets (Last 7/30/90 days, This Month, All Time).
- Type filter: multi-select (Invoice, Payment, Refund, Charge, Proration, Trial, Renewal, Suspension, Cancellation).
- Search field: by invoice_id or receipt_id, optional free-text search in description.
- Currency filter (optional) if multi-currency support exists.
- Apply/Reset actions; auto-refresh on apply; persisted in URL query params for shareable links.

3) Subscription Timeline
- Visual timeline component listing plan changes, proration events, trial start/end, renewals, and add-ons.
- Each event card shows date, event type, description, affected plan/add-on, and status.
- Linked to corresponding history items (clicking an event scrolls to the related row or highlights it).
- Inline action: View related invoice/receipt if applicable.

4) Receipt Download Drawer/Modal
- When user clicks Download on a row, present a modal or drawer with options:
  - Download PDF receipt (Stripe invoice PDF if available or generated).
  - Download CSV/JSON export of the line item(s) for that invoice.
  - View receipt inline (embedded viewer) if supported.
- Include metadata: invoice_id, date, amount, currency, customer_id, subscription_id, line items summary.

5) Support & Actions
- Support CTA section: “Need help disputing a charge? Contact Billing.”
- On-row context actions: View Invoice, View Payment Details, Retry Payment (if applicable), Cancel/Upgrade Subscription (depending on permissions).
- Status tags with color semantics: paid (green), due/pending (yellow), overdue (red), refunded (blue/green variant), failed (red).

6) Summary & Dashboard Cards (optional, for quick glance)
- Totals card: total paid this period, total outstanding, total refunds.
- Recent activity mini-list with last 5 items and quick download links.

## Implementation Requirements

### Frontend
- Pages/Routes:
  - GET /billing/history or /account/history with query params for filters.
  - Private route requiring authentication; support user roles/permissions.
- UI Components:
  - Card components (reusable) with 12-16px border radius, shadows, and hover states.
  - Table component with sortable columns, responsive behavior, compact density for desktop, stacked rows for mobile.
  - Filters panel component with accessible controls (aria-labels, proper labels, keyboard support).
  - Timeline component with vertical alignment and event cards.
  - Modal/Drawer component for receipt downloads.
  - StatusBadge component with color mapping per status.
  - Button system with primary actions in deep green (#195C4A) and secondary actions in subtle variants.
- State Management:
  - Client-side state for UI selections (filters, sort state, pagination).
  - Fetch data via API with server-side filtering; show skeleton loaders while loading.
  - Debounce search input to avoid excessive requests.
- Accessibility:
  - Proper semantic HTML (table, thead, tbody for history; list semantics for timeline).
  - Keyboard navigable controls; screen-reader friendly labels.
- Performance:
  - Infinite/next-page pagination or page-based pagination with reasonable page size (e.g., 20).
  - Caching of frequently requested filter sets if feasible.

### Backend
- Data Model (Database Tables/Entities):
  - users: id, email, role, etc. (existing)
  - invoices: id, invoice_id, user_id, subscription_id, date_issued, date_due, amount_due, currency, status, pdf_url, hosted_invoice_url, total_amount, line_items_json
  - payments: id, payment_id, user_id, invoice_id, date_paid, amount, currency, status, payment_method (card/ach), last4, brand
  - refunds: id, refund_id, payment_id, invoice_id, date_refunded, amount, currency, status
  - subscriptions: id, user_id, plan_id, status, current_period_start, current_period_end, trial_end, renewal_date, addons_json, proration
  - subscription_events: id, subscription_id, event_type (plan_change, proration, trial_start, trial_end, renewal, add_on), event_date, details_json
- API Endpoints:
  - GET /api/billing/history
    - Query params: start_date, end_date, types[], query, page, page_size, sort_by, sort_order
    - Response: list of history items (invoices, payments, refunds, charges, proration, renewals) with fields: id, type, date, amount, currency, status, invoice_id, subscription_id, description, downloadable_receipt_url
  - GET /api/billing/history/{item_id}
    - Retrieve detailed view for a single history item
  - GET /api/billing/invoice/{invoice_id}/download
    - Returns PDF or direct URL to download receipt
  - GET /api/billing/subscription/{subscription_id}/timeline
    - Returns timeline events for a subscription
  - GET /api/billing/subscription/{subscription_id}
    - Retrieve subscription details for timeline context
  - POST /api/billing/subscription/{subscription_id}/cancel
    - Requires appropriate permissions; cancel subscription
  - POST /api/billing/subscription/{subscription_id}/change
    - Change plan/add-ons; creates a prorated event
- Data Transformation:
  - Normalize Stripe webhook data to internal history items; map Stripe invoice statuses to internal status values.
- Security/Access Control:
  - JWT/OAuth-based authentication for API access.
  - Ensure users can only query history relevant to their account or permitted scope (e.g., admins can view all).
  - Rate limiting and CSRF protection for state-changing endpoints.
- Validation:
  - Validate date formats (ISO 8601), required fields for creation endpoints (where applicable), and correct types for filter params.
- Logging/Audit:
  - Audit trail for downloads and access to receipts; log changes to subscriptions and invoices.

### Integration
- Frontend ↔ Backend:
  - Implement a data fetch layer that calls /api/billing/history with filters; map API response to frontend models.
  - Integrate with /api/billing/invoice/{id}/download for receipts.
  - On selecting a subscription event in the timeline, fetch related history items for context.
- Stripe:
  - Use Stripe webhooks to populate internal invoices, payments, refunds, and subscription_events data.
  - Generate and expose receipt PDFs via hosted URLs or inline PDF rendering as needed.
- UI Consistency:
  - Reuse Card, Button, Table, and Timeline components to ensure visual consistency with the project’s design system.

## User Experience Flow
1) User arrives at Transaction / Order History page.
2) Page loads with initial data (default date range, e.g., last 90 days). Skeletons shown while loading.
3) User uses Filters:
   - Sets date range, types, and enters a search query.
   - Clicks Apply; data table refreshes with filtered results; URL updates with query params.
4) User scrolls through the Transactions Table:
   - Sort by date or amount; navigate pages; hover rows to see row-level actions.
   - Click Download on any item to fetch its receipt; a modal/drawer opens with options (PDF, CSV/JSON, inline view).
5) User interacts with the Subscription Timeline:
   - Clicks an event to highlight the related history item; or filter the timeline by event type.
   - If available, view related invoice or payment by following links in the timeline.
6) User needs support:
   - Clicks the Billing Support CTA for disputes; opens a contact modal or directs to a support form.
7) Optional: Admin user uses additional actions to manage subscriptions or view broader reports.

## Technical Specifications
- Data Models: As described above (invoices, payments, refunds, subscriptions, subscription_events).
- API Endpoints: Detailed list provided under Backend.
- Security:
  - Authentication: OAuth 2.0 / JWT; access tokens with proper scopes.
  - Authorization: Users can view their own history; admins can view all; ensure role-based access checks on endpoints.
  - Data in transit encrypted (TLS).
- Validation:
  - Date range boundaries, allowed types, non-empty invoice_id when requesting a receipt, pagination bounds (page >= 1, page_size between 10-100).
- Internationalization: If required, support multiple currencies and localized date formats.

## Acceptance Criteria
- [ ] The page loads with a responsive Transactions Table showing at least 20 items for a given user, with accurate date, type, amount, currency, status, and a download link.
- [ ] Filters correctly narrow the dataset; Apply updates URL query params; results refresh without full page reload.
- [ ] Download receipts function reliably returns a PDF or accessible URL for each invoice; modal provides PDF + CSV/JSON export options.
- [ ] Subscription Timeline renders with at least one plan change or proration event and links to related history items.
- [ ] Admin and user roles enforce access control; non-authorized users cannot access history or download receipts.
- [ ] UI matches the design system: typography, color palette, card styling, spacing, and responsive behavior.
- [ ] Accessibility: all interactive elements are keyboard accessible; screen reader friendly labels; color contrast meets WCAG 2.1 AA.

## UI/UX Guidelines
Apply the project's design system:
- Follow the provided color palette, typography, spacing (8px increments), and card styling.
- Navigation: Top pill-shaped tabs for different sections; active state uses deep green (#195C4A).
- Cards: White background, soft shadows, rounded corners (12-16px), generous padding (24px).
- Data Visualization: If charts are added (e.g., totals vs. time), use blue primary and green/red for deltas; maintain minimal grid lines.
- Interactive Elements: Pill-shaped buttons; primary actions in deep green; hover/focus states with subtle shadows and color shifts; rounded inputs with soft backgrounds.
- Visual Hierarchy: Clear page title, section headers, and data rows; ensure scannability of long invoices with truncation and tooltips where appropriate.
- Mobile-first: Ensure touch targets are large; collapsible filters; responsive table with horizontal scrolling on small viewports.

## Visual Style

Color Palette (as specified):
- Primary: #FFFFFF
- Secondary: #F5F6FA, #F7F8FA
- Accent Colors:
  - Deep green: #195C4A
  - Bright green: #7BE495
  - Soft yellow: #FFE8A3
  - Muted orange: #FFDCA8
  - Light red: #FF6C6C
- Text Colors:
  - Dark gray: #23272F
  - Medium gray: #6B7280
- Subtle borders/shadows: #E6E8F0, #D1D5DB

Typography & Layout:
- Font: Inter, SF Pro, or Manrope
- Weights: 400/500/600
- Spacing: 24-32px container padding, 16-24px gaps, 8px increments
- Layout: Left-aligned content, card-based sections, consistent rhythm

Key Design Elements (as described):
- Card Design with elevation, 12-16px radius
- Navigation with pill tabs and active deep green state
- Data Visualization: Clear line charts if used
- Interactive Elements: Pill buttons, soft hover states, rounded inputs, status tags

Design Philosophy:
- Modern, minimal, professional; accessible; mobile-first; trustworthy.

Connected Features:
- Payment & Billing: Stripe-based subscriptions, invoices, add-ons.

---

Note: The prompt should guide an AI development tool to implement end-to-end functionality, including frontend UI components, backend data models, API endpoints, integration with Stripe, and a polished, accessible UI aligned with the specified design language. for style.

CRITICAL DESIGN REQUIREMENTS:
- You MUST follow ALL design principles and patterns specified in the Design Reference above
- Do NOT deviate from the design specifications without explicit user permission
- Implement ALL visual design elements (colors, typography, spacing, shadows, animations) as specified
- Follow the layout patterns and component designs exactly as documented
- Ensure all interactions and micro-animations match the reference specifications

CRITICAL TECHNICAL REQUIREMENTS:
- React 18.3.1, React Router 6.30.1
- Tailwind CSS v3 with tailwind.config.js and custom keyframes
- @tailwindcss/typography plugin for rich text content
- Tailwind CSS animations (NOT Motion library or framer-motion)
- Sonner for toasts
- Recharts for data visualization
- Native fetch() with API utilities in src/lib/api.ts
- Design system with CSS custom properties
- Use RGB color values for theming
- When Supabase is configured: use Edge Functions for LLM and server-only logic; never expose API keys in the client

=== TASK ===
# Transaction / Order History

## Overview
Build a comprehensive Transaction / Order History page that presents a clear, searchable, and filterable record of past payments, invoices, and subscription events. The page should support downloadable receipts, inline status indicators, and a subscription timeline. It must integrate with the project's Payment & Billing system (Stripe) for invoices, subscriptions, add-ons, and events, and provide a cohesive UI consistent with the design system described. The feature should be mobile-friendly, accessible, and perform well with pagination, server-side filtering, and secure access.

## Page Description (Full Detail)
What this page is:
- A centralized history view for all financial activities and subscription events related to a user or account. It consolidates payments, invoices, refunds, and subscription lifecycle events (plan changes, proration, trials, renewals) into a single, navigable interface.
Goals:
- Provide an at-a-glance summary of recent financial activity with status badges (paid, pending, overdue, failed).
- Allow users to filter by date range, type (invoice, payment, refund, proration, trial, charge, cancellation), and search by invoice/receipt ID.
- Enable downloading receipts/invoices as PDF or structured data (CSV/JSON) when available.
- Show a subscription timeline with events (plan changes, add-ons, proration, trial periods) aligned to the history items.
- Facilitate quick access to billing actions (view invoice, contact billing support for disputes, manage subscription if permissions allow).
Connected features:
- Stripe-based Payment & Billing: Invoices, subscriptions, invoice line items, add-ons, refunds, and proration events. Ensure secure tokenized access to Stripe receipts or generated PDFs where applicable.
UI/UX guidance:
- Display a Transactions Table with sortable columns, pagination, and inline actions.
- Include a Subscription Timeline component showing key lifecycle events.
- Provide a Filters panel with date range pickers, type selectors, and a free-text search field.
- Include a Support CTA for billing inquiries.
- Use card-based sections with consistent typography, spacing, and visual hierarchy.

## Components to Build
1) Transactions Table
- Data: date, type (invoice, payment, refund, charge, proration, renewal), invoice_id/receipt_id, description, amount (positive/negative), currency, status, downloadable_receipt (URL or blob), payment_method (card/stripe), account_balance, related_subscription_id.
- Features: sorting by date, type, amount; pagination; per-row action to Download receipt; status badge; inline search highlight.
- UI: Card container, header with page title, filters toolbar, table with accessible headers, responsive design (horizontal scroll on small screens), compact row height, hover row highlight, keyboard navigable.

2) Filters Panel
- Date range selector (start_date, end_date) with quick presets (Last 7/30/90 days, This Month, All Time).
- Type filter: multi-select (Invoice, Payment, Refund, Charge, Proration, Trial, Renewal, Suspension, Cancellation).
- Search field: by invoice_id or receipt_id, optional free-text search in description.
- Currency filter (optional) if multi-currency support exists.
- Apply/Reset actions; auto-refresh on apply; persisted in URL query params for shareable links.

3) Subscription Timeline
- Visual timeline component listing plan changes, proration events, trial start/end, renewals, and add-ons.
- Each event card shows date, event type, description, affected plan/add-on, and status.
- Linked to corresponding history items (clicking an event scrolls to the related row or highlights it).
- Inline action: View related invoice/receipt if applicable.

4) Receipt Download Drawer/Modal
- When user clicks Download on a row, present a modal or drawer with options:
  - Download PDF receipt (Stripe invoice PDF if available or generated).
  - Download CSV/JSON export of the line item(s) for that invoice.
  - View receipt inline (embedded viewer) if supported.
- Include metadata: invoice_id, date, amount, currency, customer_id, subscription_id, line items summary.

5) Support & Actions
- Support CTA section: “Need help disputing a charge? Contact Billing.”
- On-row context actions: View Invoice, View Payment Details, Retry Payment (if applicable), Cancel/Upgrade Subscription (depending on permissions).
- Status tags with color semantics: paid (green), due/pending (yellow), overdue (red), refunded (blue/green variant), failed (red).

6) Summary & Dashboard Cards (optional, for quick glance)
- Totals card: total paid this period, total outstanding, total refunds.
- Recent activity mini-list with last 5 items and quick download links.

## Implementation Requirements

### Frontend
- Pages/Routes:
  - GET /billing/history or /account/history with query params for filters.
  - Private route requiring authentication; support user roles/permissions.
- UI Components:
  - Card components (reusable) with 12-16px border radius, shadows, and hover states.
  - Table component with sortable columns, responsive behavior, compact density for desktop, stacked rows for mobile.
  - Filters panel component with accessible controls (aria-labels, proper labels, keyboard support).
  - Timeline component with vertical alignment and event cards.
  - Modal/Drawer component for receipt downloads.
  - StatusBadge component with color mapping per status.
  - Button system with primary actions in deep green (#195C4A) and secondary actions in subtle variants.
- State Management:
  - Client-side state for UI selections (filters, sort state, pagination).
  - Fetch data via API with server-side filtering; show skeleton loaders while loading.
  - Debounce search input to avoid excessive requests.
- Accessibility:
  - Proper semantic HTML (table, thead, tbody for history; list semantics for timeline).
  - Keyboard navigable controls; screen-reader friendly labels.
- Performance:
  - Infinite/next-page pagination or page-based pagination with reasonable page size (e.g., 20).
  - Caching of frequently requested filter sets if feasible.

### Backend
- Data Model (Database Tables/Entities):
  - users: id, email, role, etc. (existing)
  - invoices: id, invoice_id, user_id, subscription_id, date_issued, date_due, amount_due, currency, status, pdf_url, hosted_invoice_url, total_amount, line_items_json
  - payments: id, payment_id, user_id, invoice_id, date_paid, amount, currency, status, payment_method (card/ach), last4, brand
  - refunds: id, refund_id, payment_id, invoice_id, date_refunded, amount, currency, status
  - subscriptions: id, user_id, plan_id, status, current_period_start, current_period_end, trial_end, renewal_date, addons_json, proration
  - subscription_events: id, subscription_id, event_type (plan_change, proration, trial_start, trial_end, renewal, add_on), event_date, details_json
- API Endpoints:
  - GET /api/billing/history
    - Query params: start_date, end_date, types[], query, page, page_size, sort_by, sort_order
    - Response: list of history items (invoices, payments, refunds, charges, proration, renewals) with fields: id, type, date, amount, currency, status, invoice_id, subscription_id, description, downloadable_receipt_url
  - GET /api/billing/history/{item_id}
    - Retrieve detailed view for a single history item
  - GET /api/billing/invoice/{invoice_id}/download
    - Returns PDF or direct URL to download receipt
  - GET /api/billing/subscription/{subscription_id}/timeline
    - Returns timeline events for a subscription
  - GET /api/billing/subscription/{subscription_id}
    - Retrieve subscription details for timeline context
  - POST /api/billing/subscription/{subscription_id}/cancel
    - Requires appropriate permissions; cancel subscription
  - POST /api/billing/subscription/{subscription_id}/change
    - Change plan/add-ons; creates a prorated event
- Data Transformation:
  - Normalize Stripe webhook data to internal history items; map Stripe invoice statuses to internal status values.
- Security/Access Control:
  - JWT/OAuth-based authentication for API access.
  - Ensure users can only query history relevant to their account or permitted scope (e.g., admins can view all).
  - Rate limiting and CSRF protection for state-changing endpoints.
- Validation:
  - Validate date formats (ISO 8601), required fields for creation endpoints (where applicable), and correct types for filter params.
- Logging/Audit:
  - Audit trail for downloads and access to receipts; log changes to subscriptions and invoices.

### Integration
- Frontend ↔ Backend:
  - Implement a data fetch layer that calls /api/billing/history with filters; map API response to frontend models.
  - Integrate with /api/billing/invoice/{id}/download for receipts.
  - On selecting a subscription event in the timeline, fetch related history items for context.
- Stripe:
  - Use Stripe webhooks to populate internal invoices, payments, refunds, and subscription_events data.
  - Generate and expose receipt PDFs via hosted URLs or inline PDF rendering as needed.
- UI Consistency:
  - Reuse Card, Button, Table, and Timeline components to ensure visual consistency with the project’s design system.

## User Experience Flow
1) User arrives at Transaction / Order History page.
2) Page loads with initial data (default date range, e.g., last 90 days). Skeletons shown while loading.
3) User uses Filters:
   - Sets date range, types, and enters a search query.
   - Clicks Apply; data table refreshes with filtered results; URL updates with query params.
4) User scrolls through the Transactions Table:
   - Sort by date or amount; navigate pages; hover rows to see row-level actions.
   - Click Download on any item to fetch its receipt; a modal/drawer opens with options (PDF, CSV/JSON, inline view).
5) User interacts with the Subscription Timeline:
   - Clicks an event to highlight the related history item; or filter the timeline by event type.
   - If available, view related invoice or payment by following links in the timeline.
6) User needs support:
   - Clicks the Billing Support CTA for disputes; opens a contact modal or directs to a support form.
7) Optional: Admin user uses additional actions to manage subscriptions or view broader reports.

## Technical Specifications
- Data Models: As described above (invoices, payments, refunds, subscriptions, subscription_events).
- API Endpoints: Detailed list provided under Backend.
- Security:
  - Authentication: OAuth 2.0 / JWT; access tokens with proper scopes.
  - Authorization: Users can view their own history; admins can view all; ensure role-based access checks on endpoints.
  - Data in transit encrypted (TLS).
- Validation:
  - Date range boundaries, allowed types, non-empty invoice_id when requesting a receipt, pagination bounds (page >= 1, page_size between 10-100).
- Internationalization: If required, support multiple currencies and localized date formats.

## Acceptance Criteria
- [ ] The page loads with a responsive Transactions Table showing at least 20 items for a given user, with accurate date, type, amount, currency, status, and a download link.
- [ ] Filters correctly narrow the dataset; Apply updates URL query params; results refresh without full page reload.
- [ ] Download receipts function reliably returns a PDF or accessible URL for each invoice; modal provides PDF + CSV/JSON export options.
- [ ] Subscription Timeline renders with at least one plan change or proration event and links to related history items.
- [ ] Admin and user roles enforce access control; non-authorized users cannot access history or download receipts.
- [ ] UI matches the design system: typography, color palette, card styling, spacing, and responsive behavior.
- [ ] Accessibility: all interactive elements are keyboard accessible; screen reader friendly labels; color contrast meets WCAG 2.1 AA.

## UI/UX Guidelines
Apply the project's design system:
- Follow the provided color palette, typography, spacing (8px increments), and card styling.
- Navigation: Top pill-shaped tabs for different sections; active state uses deep green (#195C4A).
- Cards: White background, soft shadows, rounded corners (12-16px), generous padding (24px).
- Data Visualization: If charts are added (e.g., totals vs. time), use blue primary and green/red for deltas; maintain minimal grid lines.
- Interactive Elements: Pill-shaped buttons; primary actions in deep green; hover/focus states with subtle shadows and color shifts; rounded inputs with soft backgrounds.
- Visual Hierarchy: Clear page title, section headers, and data rows; ensure scannability of long invoices with truncation and tooltips where appropriate.
- Mobile-first: Ensure touch targets are large; collapsible filters; responsive table with horizontal scrolling on small viewports.

## Visual Style

Color Palette (as specified):
- Primary: #FFFFFF
- Secondary: #F5F6FA, #F7F8FA
- Accent Colors:
  - Deep green: #195C4A
  - Bright green: #7BE495
  - Soft yellow: #FFE8A3
  - Muted orange: #FFDCA8
  - Light red: #FF6C6C
- Text Colors:
  - Dark gray: #23272F
  - Medium gray: #6B7280
- Subtle borders/shadows: #E6E8F0, #D1D5DB

Typography & Layout:
- Font: Inter, SF Pro, or Manrope
- Weights: 400/500/600
- Spacing: 24-32px container padding, 16-24px gaps, 8px increments
- Layout: Left-aligned content, card-based sections, consistent rhythm

Key Design Elements (as described):
- Card Design with elevation, 12-16px radius
- Navigation with pill tabs and active deep green state
- Data Visualization: Clear line charts if used
- Interactive Elements: Pill buttons, soft hover states, rounded inputs, status tags

Design Philosophy:
- Modern, minimal, professional; accessible; mobile-first; trustworthy.

Connected Features:
- Payment & Billing: Stripe-based subscriptions, invoices, add-ons.

---

Note: The prompt should guide an AI development tool to implement end-to-end functionality, including frontend UI components, backend data models, API endpoints, integration with Stripe, and a polished, accessible UI aligned with the specified design language.

=== SUCCESS CRITERIA ===
# Success Criteria Checklist

## Code Quality

### TypeScript
- [ ] No TypeScript errors (`tsc --noEmit` passes)
- [ ] All functions and components have proper type definitions
- [ ] No `any` types used (use `unknown` if type is truly unknown)
- [ ] Props interfaces defined for all components
- [ ] API responses have type definitions

### Code Standards
- [ ] All imports use path aliases (@/ prefix)
- [ ] Components follow the established naming convention
- [ ] Files are organized in correct directories
- [ ] No unused imports or variables
- [ ] Consistent code formatting

## Component Implementation

### UI Components
- [ ] Use shadcn/ui components (Button, Card, Input, etc.) instead of building from scratch
- [ ] All interactive elements have hover states
- [ ] Components use the `cn()` utility for class merging
- [ ] Proper TypeScript props interfaces defined
- [ ] Components are responsive (mobile, tablet, desktop)

### Animations
- [ ] Motion library used for all animations (NOT framer-motion)
- [ ] Page transitions implemented with fade/slide
- [ ] Interactive elements have whileHover/whileTap animations
- [ ] List items use stagger animations where appropriate
- [ ] Animations respect `prefers-reduced-motion`

### Icons
- [ ] Lucide React icons used consistently
- [ ] Icons have consistent sizing (h-4 w-4, h-5 w-5, h-6 w-6)
- [ ] Icon colors match design system (text-primary, text-muted-foreground)

## Data Management

### React Query
- [ ] All data fetching uses React Query hooks
- [ ] Query keys follow the established pattern
- [ ] Mutations invalidate related queries
- [ ] Loading and error states handled
- [ ] Optimistic updates implemented where appropriate

### Forms
- [ ] Forms use react-hook-form
- [ ] Validation uses Zod schemas
- [ ] Error messages display properly
- [ ] Form submission shows loading state
- [ ] Success/error feedback via toast notifications

### API Layer
- [ ] API functions in src/api/ directory
- [ ] Axios used for HTTP requests
- [ ] Proper error handling with try/catch
- [ ] Auth tokens handled by interceptors
- [ ] Type-safe API function signatures

## User Experience

### Notifications
- [ ] Sonner toasts used for all notifications
- [ ] Success actions show success toast
- [ ] Errors show descriptive error messages
- [ ] Loading states show toast.loading()

### Loading States
- [ ] Skeleton loaders shown during data fetch
- [ ] Buttons show loading state during submission
- [ ] Disabled state applied during async operations

### Error Handling
- [ ] Network errors caught and displayed
- [ ] User-friendly error messages (no stack traces)
- [ ] Fallback UI for error states
- [ ] No unhandled promise rejections

## Navigation

### Route Accessibility
- [ ] All pages have routes defined in router configuration
- [ ] Every page is accessible through navigation (menu, sidebar, or direct URL)
- [ ] Main pages (Dashboard, Home, Settings, etc.) accessible from primary navigation
- [ ] Secondary pages accessible through contextual navigation or direct links
- [ ] Deep-linked pages have breadcrumbs or back navigation
- [ ] 404/Not Found page implemented for invalid routes
- [ ] Protected routes have proper authentication checks
- [ ] Navigation state persists across page refreshes where appropriate

### Navigation UX
- [ ] Active route highlighted in navigation menu
- [ ] Clear visual hierarchy in navigation structure
- [ ] Mobile navigation is accessible and usable
- [ ] Navigation items have hover/focus states
- [ ] Nested routes show parent-child relationships
- [ ] User can always return to main areas (Dashboard/Home)

## Styling

### Tailwind CSS
- [ ] Tailwind v3 classes used
- [ ] HSL color variables from design system
- [ ] Custom CSS properties used where defined
- [ ] Responsive breakpoints: mobile-first approach
- [ ] Dark mode support via CSS variables

### Design System
- [ ] Colors use theme variables (primary, secondary, accent)
- [ ] Spacing uses Tailwind scale (p-4, gap-6, etc.)
- [ ] Border radius uses theme values (rounded-lg)
- [ ] Shadows use theme values (shadow-card)
- [ ] Typography follows Inter font system

## Accessibility

- [ ] Semantic HTML elements used
- [ ] Buttons have descriptive labels
- [ ] Forms have proper labels
- [ ] Focus states visible on interactive elements
- [ ] Color contrast meets WCAG standards

## Performance

- [ ] No console.log statements in production code
- [ ] No console errors in browser
- [ ] Images optimized (WebP, lazy loading)
- [ ] Large lists use virtualization if needed
- [ ] React Query cache configured appropriately

## Testing Readiness

- [ ] Components structured for easy testing
- [ ] Business logic separated from presentation
- [ ] Mock-friendly API layer
- [ ] No hardcoded values that should be configurable
- [ ] Environment variables properly configured

## Final Checks

- [ ] Code builds without errors (`npm run build`)
- [ ] Development server runs without errors (`npm run dev`)
- [ ] No TypeScript errors in editor
- [ ] Browser console is clean (no errors or warnings)
- [ ] All functionality works as expected
- [ ] Code follows existing project patterns
- [ ] Changes are consistent with the rest of the codebase



IMPORTANT: ALL styling and design decisions must follow the Design Reference section above EXACTLY. Do not make arbitrary design choices.

Analyze the existing project structure and implement the task following the patterns already established. Ensure all success criteria are met.